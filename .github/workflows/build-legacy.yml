name: Build Legacy macOS (10.13+)

on:
  push:
    tags:
      - 'v*.*.*-legacy'  # S√≥ roda com tags tipo v1.0.14-legacy

jobs:
  build-legacy-mac:
    runs-on: macos-12  # macOS 12 √© mais r√°pido e dispon√≠vel
    
    permissions:
      contents: write

    steps:
      - name: Checkout do c√≥digo
        uses: actions/checkout@v3

      - name: Instalar Node.js 18
        uses: actions/setup-node@v3
        with:
          node-version: 18  # Electron 22 precisa de Node 18

      - name: Instalar Python
        uses: actions/setup-python@v4
        with:
          python-version: 3.x

      - name: Instalar depend√™ncias LEGACY
        run: |
          # Remove node_modules e package-lock para evitar conflitos
          rm -rf node_modules package-lock.json
          
          # Instala depend√™ncias normais
          npm install --legacy-peer-deps
          
          # FOR√áA instala√ß√£o do Electron 22 (legacy)
          npm install electron@22.3.27 --save-dev --legacy-peer-deps --force
          
          # FOR√áA electron-builder compat√≠vel
          npm install electron-builder@24.6.4 --save-dev --legacy-peer-deps --force

      - name: Buildar para macOS Legacy
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          npx electron-builder build --mac --x64 --config electron-builder-legacy.yml

      - name: Upload para GitHub Release
        uses: softprops/action-gh-release@v1
        with:
          files: |
            dist/*.dmg
            dist/*.zip
          tag_name: ${{ github.ref_name }}
          name: "üçé Legacy - macOS 10.13 High Sierra+"
          body: |
            ## Vers√£o Legacy para macOS Antigos
            
            ‚ö†Ô∏è **Use esta vers√£o APENAS se voc√™ tem macOS 10.13 ou 10.14**
            
            ‚úÖ Compat√≠vel com:
            - macOS 10.13 High Sierra
            - macOS 10.14 Mojave
            
            üì• Baixe o arquivo `.dmg` abaixo
            
            ---
            
            üÜï **Usu√°rios com macOS 10.15 ou superior:**
            Baixe a vers√£o normal (mais recente e otimizada)
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}