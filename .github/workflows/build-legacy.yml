name: Build Legacy macOS (10.13+)

on:
  push:
    tags:
      - 'v*.*.*-legacy'  # S√≥ roda com tags tipo v1.0.14-legacy
  workflow_dispatch:      # Permite rodar manualmente tamb√©m

jobs:
  build-legacy-mac:
    runs-on: macos-latest  # <<< CORRIGIDO

    permissions:
      contents: write

    steps:
      - name: Checkout do c√≥digo
        uses: actions/checkout@v3

      - name: Instalar Node.js 18
        uses: actions/setup-node@v3
        with:
          node-version: 18

      - name: Instalar Python
        uses: actions/setup-python@v4
        with:
          python-version: 3.x

      - name: Instalar depend√™ncias LEGACY
        run: |
          rm -rf node_modules package-lock.json

          npm install --legacy-peer-deps
          npm install electron@22.3.27 --save-dev --legacy-peer-deps --force
          npm install electron-builder@24.6.4 --save-dev --legacy-peer-deps --force

      - name: Buildar para macOS Legacy
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          npx electron-builder build --mac --x64 --config electron-builder-legacy.yml

      - name: Upload para GitHub Release
        uses: softprops/action-gh-release@v1
        with:
          files: |
            dist/*.dmg
            dist/*.zip
          tag_name: ${{ github.ref_name }}
          name: "üçé Legacy - macOS 10.13 High Sierra+"
          body: |
            ## Vers√£o Legacy para macOS Antigos
            
            ‚ö†Ô∏è Use esta vers√£o APENAS se estiver no:
            - macOS 10.13 High Sierra
            - macOS 10.14 Mojave
            
            Usu√°rios com macOS 10.15+ devem baixar a vers√£o normal.
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}