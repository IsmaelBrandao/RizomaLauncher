name: Build Legacy macOS

# Dispara quando voc√™ criar uma tag com sufixo -legacy (ex: v1.0.14-legacy)
on:
  push:
    tags:
      - 'v*.*.*-legacy'

jobs:
  release-legacy:
    runs-on: macos-11  # Vers√£o mais antiga dispon√≠vel no GitHub Actions
    
    permissions:
      contents: write

    steps:
      - name: Checkout c√≥digo
        uses: actions/checkout@v3

      - name: Configurar Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18  # Electron legacy precisa de Node mais antigo

      - name: Configurar Python (para node-gyp)
        uses: actions/setup-python@v4
        with:
          python-version: 3.x

      # CR√çTICO: Instalar depend√™ncias com Electron legacy
      - name: Instalar depend√™ncias legacy
        run: |
          npm install --legacy-peer-deps
          npm install electron@22.3.27 --save-dev --legacy-peer-deps
          npm install electron-builder@24.6.4 --save-dev --legacy-peer-deps

      - name: Build para macOS Legacy
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          CSC_IDENTITY_AUTO_DISCOVERY: false  # Desabilita assinatura
        run: |
          npx electron-builder build --mac --config electron-builder-legacy.yml
      
      - name: Upload para Release
        uses: softprops/action-gh-release@v1
        if: startsWith(github.ref, 'refs/tags/')
        with:
          files: |
            dist/*.dmg
            dist/*.zip
          tag_name: ${{ github.ref_name }}
          name: "Legacy Release - macOS 10.13+"
          body: |
            üçé **Vers√£o Legacy para macOS antigos**
            
            - Compat√≠vel com macOS 10.13 High Sierra at√© 10.15 Catalina
            - Electron 22 (√∫ltima vers√£o com suporte a 10.13)
            - Recursos limitados comparado √† vers√£o moderna
            
            **Use esta vers√£o apenas se o launcher principal n√£o funcionar no seu Mac!**
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}